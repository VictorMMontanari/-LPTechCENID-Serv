
module.exports = function(state, action, callback) {
  var headers = {}
  for (var name in action.input.Headers) {
    headers[name] = action.input.Headers[name]
  }
  headers['Content-Type'] = 'application/json'

  state.dispatch({
    type: 'Request HTTP',
    input: {
      URL: action.input.URL,
      Method: action.input.Method,
      Headers: headers,
      Body: JSON.stringify(action.input.Body)
    }
  }, function(err, body){
    try {
      body = JSON.parse(body)
      callback(null, body)
    } catch (error) {
      callback(error)
    }
  })
}
