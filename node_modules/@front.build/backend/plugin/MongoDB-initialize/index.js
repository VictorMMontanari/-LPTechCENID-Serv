
var MongoClient = require('mongodb').MongoClient

var cachedDb

module.exports = function(state, action, callback) {
  var uri = action.input['Mongo URI'] || 'mongodb://localhost:27017'

  if (cachedDb && cachedDb.serverConfig.isConnected()) {
    return callback(null, cachedDb)
  }

  MongoClient.connect(uri, function(err, db){
    cachedDb = db
    callback(err, cachedDb)
  })
}
